!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("applets-request-weapp")):"function"==typeof define&&define.amd?define(["exports","applets-request-weapp"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).apiHttp={},t.appletsRequest)}(this,(function(t,e){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=r(e);function i(t){if(null===t||"[object Object]"!==function(t){return Object.prototype.toString.call(t)}(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function s(t,e){if(null!=t){var r=t;"object"!=typeof t&&(r=[t]),Array.isArray(r)?r.forEach((function(r,n){e.call(null,r,n,t)})):Object.keys(r).forEach((function(t){e.call(null,r[t],t,r)}))}}function a(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)return Object.create(null);var r=Object.create(null);function n(t,e){i(r[e])&&i(t)?r[e]=a(r[e],t):i(t)?r[e]=a({},t):Array.isArray(t)?r[e]=a(t):r[e]=t}return r=Array.isArray(t[0])?[]:Object.create(null),t.forEach((function(t){s(t,n)})),r}var o=function(){function t(t,e){this.hadRetry=0,this.retryTimes=2,this.interval=2e3,this.baseURL="",this.url="",this.fnName="";var r=t.retryTimes,n=t.interval;this.baseURL=t.baseURL,this.url=t.url,this.fnName=t.fnName,this.retryTimes=this.getValidNumber(this.retryTimes,r),this.interval=this.getValidNumber(this.interval,n),this.appletsRequest=e}return t.prototype.getValidNumber=function(t,e){return e||0===e?e:t},t.prototype.http=function(t){var e=this;return new Promise((function(r,n){e.request(t||{},r,n)}))},t.prototype.request=function(t,e,r){var n=this;Promise.resolve(t).then((function(t){return n.appletsRequest(t)})).then((function(t){n.hadRetry=0,e(t)})).catch((function(i){if(n.isRetryError(i)&&n.hadRetry<n.retryTimes){n.hadRetry+=1;var s=a(t,i.options||{});n.request(s,e,r)}else n.isIntervalRetryError(i)&&n.hadRetry<n.retryTimes?setTimeout((function(){n.hadRetry+=1,n.request(t,e,r)}),n.interval):r(n.isRetryError(i)?i.originalErr:i)}))},t.prototype.isRetryError=function(t){return!!t&&"RETRY_ERROR"===t.errCode},t.prototype.isIntervalRetryError=function(t){return!!t&&("NETWORK_ERROR"===t.status||"TIMEOUT"===t.status)},t}(),u=function(){function t(t,r){this.apiList={},this.apis=Object.create(null),this.appKey=t.appKey,this.appCode=t.appCode,this.baseURL=t.baseURL,this.appletsRequest=n.default.create(r||e.getDefaults()),this.createApiItem(t.apiList)}return t.prototype.createApiItem=function(t){if(n=t,Array.isArray(n)){var e=Object.create(null);t.forEach((function(t){t.fnName&&(e[t.fnName]=t)}));var r=t.map((function(t){return t.fnName}));return this.apiList=e,void this.generateApiFn(r)}var n;if(i(t)){this.apiList=t;r=Object.keys(t);this.generateApiFn(r)}},t.prototype.generateApiFn=function(t){var e=this;t.forEach((function(t){var r=e.apiList[t],n=new o({baseURL:e.baseURL,fnName:t,url:r.apiUrl,interval:r.interval,retryTimes:r.retryTimes},e.appletsRequest);e.apis[t]=n.http.bind(n),e.apis[t]=function(t,e){if("string"==typeof e)return t;for(var r in e)t[r]=e[r];return t}(e.apis[t],n)}))},t.prototype.createRetryError=function(t,e){return{errCode:"RETRY_ERROR",originalErr:t,options:e}},t.prototype.addRequestInterceptor=function(t,e){this.appletsRequest.interceptors.request.use(t,e)},t.prototype.addResponseInterceptor=function(t,e){this.appletsRequest.interceptors.response.use(t,e)},t.prototype.createCancelToken=function(){return new this.appletsRequest.CancelToken},t.prototype.transformConfig=function(t){this.appletsRequest.defaults.transformConfig=t},t}();t.default=u,Object.defineProperty(t,"__esModule",{value:!0})}));//# sourceMappingURL=applets-request-mode-list.min.js.map
